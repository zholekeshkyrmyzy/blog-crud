<!DOCTYPE html>
<html>
<head>
  <title>Blog CRUD</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, textarea { display: block; margin-bottom: 10px; width: 300px; }
    button { padding: 5px 10px; margin-right: 5px; }
    .blog { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
    .blog-edit { margin-top: 5px; }
    .blog-title { font-weight: bold; font-size: 18px; }
    .blog-author { font-style: italic; margin-bottom: 5px; }
  </style>
</head>
<body>
  <h1>Blog</h1>
  
  <h2>Create Blog</h2>
  <input id="title" placeholder="Title" />
  <textarea id="body" placeholder="Body"></textarea>
  <input id="author" placeholder="Author (optional)" />
  <button onclick="createBlog()">Create</button>
  
  <h2>All Blogs</h2>
  <div id="blogs"></div>

<script>
const api = "http://localhost:3000/blogs";

async function fetchBlogs() {
  const res = await fetch(api);
  const blogs = await res.json();
  const blogsDiv = document.getElementById("blogs");
  
  blogsDiv.innerHTML = blogs.map(b => `
    <div class="blog" id="blog-${b._id}">
      <div class="blog-title">ID ${b.blogId || '-'}: ${b.title}</div>
      <div class="blog-author">${b.author}</div>
      <div>${b.body}</div>
      <div>Created: ${new Date(b.createdAt).toLocaleString()} | Updated: ${new Date(b.updatedAt).toLocaleString()}</div>
      <button onclick="showEditForm('${b._id}')">Update</button>
      <button onclick="deleteBlog('${b._id}')">Delete</button>

      <div class="blog-edit" id="edit-${b._id}" style="display:none; margin-top:5px;">
        <input id="edit-title-${b._id}" value="${b.title}" />
        <textarea id="edit-body-${b._id}">${b.body}</textarea>
        <input id="edit-author-${b._id}" value="${b.author}" />
        <button onclick="updateBlog('${b._id}')">Update</button>
        <button onclick="hideEditForm('${b._id}')">Cancel</button>
      </div>
    </div>
  `).join("");
}

// Create blog
async function createBlog() {
  const title = document.getElementById("title").value.trim();
  const body = document.getElementById("body").value.trim();
  const author = document.getElementById("author").value.trim() || "Anonymous";
  if (!title || !body) return alert("Title and body are required!");

  const res = await fetch(api, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ title, body, author })
  });

  if (!res.ok) {
    const err = await res.json();
    return alert("Error: " + err.message);
  }

  document.getElementById("title").value = "";
  document.getElementById("body").value = "";
  document.getElementById("author").value = "";
  fetchBlogs();
}

// Delete blog
async function deleteBlog(id) {
  if (!confirm("Are you sure you want to delete this blog?")) return;

  const res = await fetch(`${api}/${id}`, { method: "DELETE" });
  if (!res.ok) {
    const err = await res.json();
    return alert("Error: " + err.message);
  }
  fetchBlogs();
}

function showEditForm(id) { document.getElementById(`edit-${id}`).style.display = "block"; }
function hideEditForm(id) { document.getElementById(`edit-${id}`).style.display = "none"; }

// Update blog
async function updateBlog(id) {
  const title = document.getElementById(`edit-title-${id}`).value.trim();
  const body = document.getElementById(`edit-body-${id}`).value.trim();
  const author = document.getElementById(`edit-author-${id}`).value.trim() || "Anonymous";

  if (!title || !body) return alert("Title and body are required!");

  const res = await fetch(`${api}/${id}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ title, body, author })
  });

  if (!res.ok) {
    const err = await res.json();
    return alert("Error: " + err.message);
  }

  hideEditForm(id);
  fetchBlogs();
}


fetchBlogs();
</script>
</body>
</html>
