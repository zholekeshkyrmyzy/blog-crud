<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Blog CRUD</title>
  <style>
    body { font-family: Arial; padding: 20px; background:#f5f5f5; }
    input, textarea { display: block; margin-bottom: 10px; width: 300px; padding:5px; }
    button { padding: 5px 10px; margin-right: 5px; cursor:pointer; }
    .blog { background:white; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius:5px; }
    .blog-title { font-weight: bold; font-size: 18px; }
    .blog-author { font-style: italic; color:#555; }
    .blog-edit { margin-top: 10px; }
  </style>
</head>
<body>

<h1>Blog CRUD</h1>

<h2>Create Blog</h2>
<input id="title" placeholder="Title">
<textarea id="body" placeholder="Body"></textarea>
<input id="author" placeholder="Author (optional)">
<button onclick="createBlog()">Create</button>

<h2>All Blogs</h2>
<div id="blogs"></div>

<script>
const api = "http://localhost:3000/blogs";

async function fetchBlogs() {
  const res = await fetch(api);
  const blogs = await res.json();
  const div = document.getElementById("blogs");

  div.innerHTML = blogs.map(b => `
    <div class="blog">
      <div class="blog-title">ID: ${b._id}</div>
      <div class="blog-title">${b.title}</div>
      <div class="blog-author">${b.author}</div>
      <p>${b.body}</p>
      <small>
        Created: ${new Date(b.createdAt).toLocaleString()} |
        Updated: ${new Date(b.updatedAt).toLocaleString()}
      </small><br><br>

      <button onclick="showEdit('${b._id}')">Update</button>
      <button onclick="deleteBlog('${b._id}')">Delete</button>

      <div id="edit-${b._id}" class="blog-edit" style="display:none;">
        <input id="edit-title-${b._id}" value="${b.title}">
        <textarea id="edit-body-${b._id}">${b.body}</textarea>
        <input id="edit-author-${b._id}" value="${b.author}">
        <button onclick="updateBlog('${b._id}')">Save</button>
        <button onclick="hideEdit('${b._id}')">Cancel</button>
      </div>
    </div>
  `).join("");
}

async function createBlog() {
  const title = titleInput.value.trim();
  const body = bodyInput.value.trim();
  const author = authorInput.value.trim() || "Anonymous";

  if (!title || !body) return alert("Title and body required");

  await fetch(api, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ title, body, author })
  });

  titleInput.value = "";
  bodyInput.value = "";
  authorInput.value = "";
  fetchBlogs();
}

async function deleteBlog(id) {
  if (!confirm("Delete this blog?")) return;
  await fetch(`${api}/${id}`, { method: "DELETE" });
  fetchBlogs();
}

function showEdit(id) {
  document.getElementById(`edit-${id}`).style.display = "block";
}

function hideEdit(id) {
  document.getElementById(`edit-${id}`).style.display = "none";
}

async function updateBlog(id) {
  const title = document.getElementById(`edit-title-${id}`).value;
  const body = document.getElementById(`edit-body-${id}`).value;
  const author = document.getElementById(`edit-author-${id}`).value || "Anonymous";

  await fetch(`${api}/${id}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ title, body, author })
  });

  hideEdit(id);
  fetchBlogs();
}

const titleInput = document.getElementById("title");
const bodyInput = document.getElementById("body");
const authorInput = document.getElementById("author");

fetchBlogs();
</script>

</body>
</html>
